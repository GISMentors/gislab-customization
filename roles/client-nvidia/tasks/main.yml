# Install Nvidia drivers on client

- name: Check if we are running GIS.lab Unit
  shell: grep GISLAB_UNIQUE_ID /etc/gislab_version
  register: gislab_unit

- name: Install software-properties-common package
  shell: >
    export DEBIAN_FRONTEND=noninteractive
    &&
    chroot {{ root_dir }}
    apt {{ apt_get_opts }} install {{ item }}
  args:
    executable: /bin/bash
  with_items:
    - software-properties-common
  when:
    gislab_unit.rc == 0

- name: Add Ubuntu restricted repository
  shell: >
    export DEBIAN_FRONTEND=noninteractive
    &&
    chroot {{ root_dir }}
    add-apt-repository --update --yes "deb http://archive.ubuntu.com/ubuntu $(lsb_release -sc) restricted"
  when:
    gislab_unit.rc == 0

- name: Install nvidia packages
  shell: >
    export DEBIAN_FRONTEND=noninteractive
    &&
    chroot {{ root_dir }}
    apt {{ apt_get_opts }} install {{ item }}
  args:
    executable: /bin/bash
  with_items:
    - nvidia-current
    - nvidia-settings
  when:
    gislab_unit.rc == 0
